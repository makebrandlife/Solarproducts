<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Solar3D India - Advanced Solar Solutions with 3D Visualization</title>
  <meta name="description" content="Discover India's best solar products with interactive 3D visualization. Amazon affiliate store featuring solar panels, generators, and accessories with expert reviews.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* CSS optimized for performance - minimal, critical CSS only */
    :root {
      --primary: #00c2ff;
      --secondary: #00ff87;
      --accent: #ff2e87;
      --amazon: #FF9900;
      --dark: #0a1929;
      --light: #f5f5f5;
      --text: #333333;
      --text-light: #777777;
      --gradient: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      --glass: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.15);
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      --radius: 12px;
    }
    
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Inter', sans-serif;background:var(--light);color:var(--text);line-height:1.7;overflow-x:hidden;background-image:radial-gradient(circle at 15% 50%, rgba(0,194,255,0.08) 0%, transparent 20%), radial-gradient(circle at 85% 30%, rgba(0,255,135,0.08) 0%, transparent 20%);}
    .container{width:100%;max-width:1200px;margin:0 auto;padding:0 20px;}
    
    /* Header */
    .header{position:fixed;top:0;width:100%;z-index:1000;padding:1rem 0;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);border-bottom:1px solid var(--glass-border);box-shadow:0 5px 15px rgba(0,0,0,.1)}
    .header-inner{display:flex;justify-content:space-between;align-items:center}
    .logo{display:flex;align-items:center;font-weight:700;font-size:1.3rem;color:var(--dark);text-decoration:none}
    .logo-icon{font-size:1.8rem;margin-right:.5rem;color:var(--primary)}
    .nav-list{display:flex;list-style:none}
    .nav-item{margin-left:1.5rem}
    .nav-link{text-decoration:none;color:var(--text);font-weight:500;transition:color .3s;font-size:0.95rem}
    .nav-link:hover{color:var(--primary)}
    .mobile-menu-btn{display:none;font-size:1.5rem;background:none;border:none;color:var(--dark);cursor:pointer;padding:0.5rem}
    
    /* Hero Section */
    .hero{min-height:100vh;display:flex;align-items:center;padding:6rem 0 4rem;position:relative}
    .hero-title{font-size:2.8rem;font-weight:900;margin-bottom:1.5rem;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1.2}
    .hero-subtitle{font-size:1.3rem;margin-bottom:2.5rem;color:var(--text-light);font-weight:400}
    .btn{display:inline-block;padding:0.9rem 1.8rem;border-radius:50px;font-weight:600;cursor:pointer;transition:all .3s;text-decoration:none;border:none;font-size:0.95rem}
    .btn-primary{background:var(--gradient);color:white;margin-right:1rem}
    .btn-outline{background:transparent;color:var(--primary);border:2px solid var(--primary)}
    .amazon-btn{display:block;background-color:var(--amazon);color:black;text-align:center;padding:10px 16px;border-radius:var(--radius);text-decoration:none;font-weight:600;transition:all .3s;margin-top:1rem;font-size:0.9rem}
    
    /* Product Sections */
    .section{padding:4rem 0}
    .section-title{text-align:center;margin-bottom:3rem}
    .section-title h2{font-size:2.2rem;color:var(--dark);margin-bottom:0.8rem}
    .section-title p{color:var(--text-light);max-width:600px;margin:0 auto}
    .product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.8rem;margin-top:3rem}
    .product-card{background:white;border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);transition:transform .3s}
    .product-card:hover{transform:translateY(-8px)}
    .product-image img{width:100%;height:200px;object-fit:cover;display:block}
    .product-content{padding:1.5rem}
    .product-title{font-size:1.2rem;margin-bottom:.5rem;color:var(--dark);line-height:1.4}
    .product-description{color:var(--text-light);margin-bottom:1rem;font-size:.9rem;line-height:1.6}
    
    /* Modal */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:2000;align-items:center;justify-content:center;padding:20px}
    .modal-content{width:100%;max-width:1000px;background:white;border-radius:var(--radius);overflow:hidden;position:relative;display:flex;flex-direction:column}
    .modal-close{position:absolute;top:15px;right:15px;background:rgba(0,0,0,.7);color:white;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:10;border:none}
    .modal-body{padding:1.5rem}
    #modal-viewer{width:100%;height:420px;background:#f0f0f0;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}
    .viewer-overlay { position:absolute; left:10px; top:10px; z-index:20; color:#fff; font-weight:600; background:rgba(0,0,0,.5); padding:6px 10px; border-radius:8px; }
    .loading-spinner{display:inline-block;width:18px;height:18px;border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;animation:spin 1s linear infinite;margin-right:10px;vertical-align:middle}
    @keyframes spin{to{transform:rotate(360deg)}}
    .viewer-controls{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);display:flex;gap:10px;z-index:20}
    .viewer-btn{background:rgba(0,0,0,.6);color:white;border:none;width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer}
    
    /* Mobile Nav */
    .mobile-nav{position:fixed;top:0;right:-300px;width:300px;height:100%;background:white;z-index:2000;transition:right 0.3s ease;box-shadow:-5px 0 15px rgba(0,0,0,0.1);padding:2rem 1.5rem}
    .mobile-nav.active{right:0}
    .mobile-nav-close{position:absolute;top:1rem;right:1rem;background:none;border:none;font-size:1.5rem;cursor:pointer}
    .mobile-nav-list{list-style:none;margin-top:2rem}
    .mobile-nav-item{margin-bottom:1.2rem}
    .mobile-nav-link{text-decoration:none;color:var(--text);font-weight:500;font-size:1.1rem}
    .overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:1500;display:none}
    .overlay.active{display:block}
    
    /* Footer */
    .footer{background:var(--dark);color:white;padding:3rem 0;margin-top:3rem;}
    .footer-inner{display:flex;gap:20px;flex-wrap:wrap;justify-content:space-between;align-items:center}
    
    /* SEO Content */
    .seo-content{margin-top:2rem}
    .seo-content h2{font-size:1.8rem;margin-bottom:1.2rem;color:var(--dark)}
    .seo-content p{margin-bottom:1.2rem;line-height:1.7}
    
    /* Lazy loading for images */
    img[data-src] {
      opacity: 0;
      transition: opacity 0.3s;
    }
    img.lazy-loaded {
      opacity: 1;
    }
    
    /* Performance optimizations */
    .product-card { will-change: transform; }
    
    /* Responsive Design */
    @media (max-width:992px){
      .hero-title{font-size:2.4rem}
      .hero-subtitle{font-size:1.2rem}
    }
    
    @media (max-width:768px){
      .header{padding:0.8rem 0}
      .nav-list{display:none}
      .mobile-menu-btn{display:block}
      .hero{padding:5rem 0 3rem}
      .hero-title{font-size:2.2rem}
      .hero-subtitle{font-size:1.1rem;margin-bottom:2rem}
      .btn{padding:0.8rem 1.6rem;margin-bottom:0.8rem;display:block;width:100%;text-align:center}
      .btn-primary{margin-right:0}
      .product-grid{grid-template-columns:1fr;gap:1.5rem}
      .section{padding:3rem 0}
      .section-title h2{font-size:1.9rem}
      #modal-viewer{height:320px}
      .footer-inner{flex-direction:column;text-align:center;gap:1.5rem}
    }
    
    @media (max-width:480px){
      .hero-title{font-size:1.9rem}
      .container{padding:0 15px}
      .product-content{padding:1.2rem}
      .modal-body{padding:1.2rem}
    }
  </style>
</head>
<body>
  <!-- Overlay for mobile menu -->
  <div class="overlay" id="overlay"></div>
  
  <!-- Mobile Navigation -->
  <div class="mobile-nav" id="mobile-nav">
    <button class="mobile-nav-close" id="mobile-nav-close" aria-label="Close menu"><i class="fas fa-times"></i></button>
    <ul class="mobile-nav-list">
      <li class="mobile-nav-item"><a href="#solar-kits" class="mobile-nav-link">Solar Kits</a></li>
      <li class="mobile-nav-item"><a href="#solar-panels" class="mobile-nav-link">Solar Panels</a></li>
      <li class="mobile-nav-item"><a href="#comparison" class="mobile-nav-link">Comparison</a></li>
      <li class="mobile-nav-item"><a href="#technology" class="mobile-nav-link">Technology</a></li>
      <li class="mobile-nav-item"><a href="#testimonials" class="mobile-nav-link">Testimonials</a></li>
    </ul>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-inner">
        <a href="#" class="logo" aria-label="Solar3D India Home">
          <span class="logo-icon">☀️</span>
          <span class="logo-text">Solar3D India</span>
        </a>
        <nav aria-label="Main navigation">
          <ul class="nav-list">
            <li class="nav-item"><a href="#solar-kits" class="nav-link">Solar Kits</a></li>
            <li class="nav-item"><a href="#solar-panels" class="nav-link">Solar Panels</a></li>
            <li class="nav-item"><a href="#comparison" class="nav-link">Comparison</a></li>
            <li class="nav-item"><a href="#technology" class="nav-link">Technology</a></li>
            <li class="nav-item"><a href="#testimonials" class="nav-link">Testimonials</a></li>
          </ul>
        </nav>
        <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Open menu"><i class="fas fa-bars"></i></button>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">Experience Solar Products in True 3D</h1>
        <p class="hero-subtitle">Load interactive 3D models (GLB/GLTF). Rotate, zoom and inspect with real lighting and controls.</p>
        <div class="hero-cta">
          <a href="#solar-kits" class="btn btn-primary">Explore Products</a>
          <a href="#comparison" class="btn btn-outline">View Comparison</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Solar Kits Section -->
  <section id="solar-kits" class="section">
    <div class="container">
      <div class="section-title">
        <h2>Top Selling Solar Kits</h2>
        <p>Complete solar solutions with everything you need to get started with solar power</p>
      </div>

      <div class="product-grid">
        <!-- Product 1 -->
        <div class="product-card">
          <div class="product-image">
            <img src="https://m.media-amazon.com/images/I/41kW9iy6WDL.jpg" alt="Star Home 250 Watt Solar Panel & Charger Controller" loading="lazy">
          </div>
          <div class="product-content">
            <h3 class="product-title">Star Home 250 Watt Solar Panel & Charger Controller</h3>
            <p class="product-description">Complete solar power kit with portable wheeled stand, 200W converter, and 12V Lithium-Ion Battery.</p>
            <button class="amazon-btn view-in-3d" data-model="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb">View in 3D</button>
            <a href="https://amzn.to/45U06BF" class="amazon-btn" rel="nofollow noopener" target="_blank">View on Amazon</a>
          </div>
        </div>

        <!-- Product 2 -->
        <div class="product-card">
          <div class="product-image">
            <img src="https://m.media-amazon.com/images/I/41oPJri-lmL._SY300_SX300_QL70_FMwebp_.jpg" alt="Luminous NXG+ 1150 Solar Kit" loading="lazy">
          </div>
          <div class="product-content">
            <h3 class="product-title">Luminous NXG+ 1150</h3>
            <p class="product-description">High-performance solar kit with inverter and battery for home, office & shop use.</p>
            <button class="amazon-btn view-in-3d" data-model="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Avocado/glTF-Binary/Avocado.glb">View in 3D</button>
            <a href="https://amzn.to/423XRcH" class="amazon-btn" rel="nofollow noopener" target="_blank">View on Amazon</a>
          </div>
        </div>

        <!-- Product 3 -->
        <div class="product-card">
          <div class="product-image">
            <img src="https://m.media-amazon.com/images/I/7192f1+tt2L._SX679_.jpg" alt="Luminous NXG+ 1100 Solar Kit" loading="lazy">
          </div>
          <div class="product-content">
            <h3 class="product-title">Luminous NXG+ 1100</h3>
            <p class="product-description">Complete solar power solution with efficient inverter and long-lasting battery.</p>
            <button class="amazon-btn view-in-3d" data-model="https://modelviewer.dev/shared-assets/models/Astronaut.glb">View in 3D</button>
            <a href="https://amzn.to/3I5LO7M" class="amazon-btn" rel="nofollow noopener" target="_blank">View on Amazon</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- 3D Viewer Modal -->
  <div class="modal" id="modal-3d" aria-hidden="true" role="dialog" aria-label="3D product viewer">
    <div class="modal-content">
      <button class="modal-close" id="modal-close" aria-label="Close modal"><i class="fas fa-times"></i></button>
      <div id="modal-viewer">
        <div class="viewer-overlay" id="viewer-overlay" style="display:none"><span class="loading-spinner"></span>Loading model...</div>
        <div class="viewer-controls" id="viewer-controls" style="display:none">
          <button class="viewer-btn" id="reset-view" title="Reset view"><i class="fas fa-sync"></i></button>
        </div>
      </div>
      <div class="modal-body">
        <h3 id="modal-product-title">Product Title</h3>
        <p id="modal-product-description">Product description will appear here.</p>
        <a href="#" class="amazon-btn" id="modal-amazon-link" target="_blank" rel="noopener nofollow">View on Amazon</a>
      </div>
    </div>
  </div>

  <!-- Comparison Section -->
  <section id="comparison" class="section">
    <div class="container">
      <div class="section-title">
        <h2>Solar Products Comparison</h2>
        <p>Compare the best solar products to find the perfect solution for your needs</p>
      </div>
      <div class="seo-content">
        <h2>Complete Solar Kits vs Advanced Solar Panels</h2>
        <p>When choosing between complete solar kits and advanced solar panels, it's important to understand your specific needs and how each option can benefit your home or business. Solar3D India provides detailed comparisons to help you make informed decisions about renewable energy solutions.</p>
        <p>Our interactive 3D visualization technology allows you to examine solar products in detail before making a purchase, ensuring you select the right system for your energy requirements and installation space.</p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-inner">
        <div>
          <strong>Solar3D India</strong>
          <div>Your trusted source for Amazon solar product recommendations and 3D product visualization.</div>
        </div>
        <div>&copy; 2025 Solar3D India</div>
      </div>
    </div>
  </footer>

  <!-- Load Three.js and utilities with defer -->
  <script src="https://unpkg.com/three@0.128.0/build/three.min.js" defer></script>
  <script src="https://unpkg.com/three@0.128.0/examples/js/loaders/GLTFLoader.js" defer></script>
  <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js" defer></script>

  <!-- Main JavaScript -->
  <script>
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Mobile navigation functionality
      const mobileMenuBtn = document.getElementById('mobile-menu-btn');
      const mobileNavClose = document.getElementById('mobile-nav-close');
      const mobileNav = document.getElementById('mobile-nav');
      const overlay = document.getElementById('overlay');
      
      // Mobile menu toggle
      function toggleMobileMenu() {
        mobileNav.classList.toggle('active');
        overlay.classList.toggle('active');
        document.body.style.overflow = mobileNav.classList.contains('active') ? 'hidden' : 'auto';
      }
      
      if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', toggleMobileMenu);
      if (mobileNavClose) mobileNavClose.addEventListener('click', toggleMobileMenu);
      if (overlay) overlay.addEventListener('click', toggleMobileMenu);
      
      // Smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
          const targetId = this.getAttribute('href');
          if (targetId === '#') return;
          
          const el = document.querySelector(targetId);
          if (el) {
            e.preventDefault();
            window.scrollTo({
              top: el.offsetTop - 80,
              behavior: 'smooth'
            });
            
            // Close mobile menu if open
            if (mobileNav.classList.contains('active')) {
              toggleMobileMenu();
            }
          }
        });
      });
      
      // Lazy loading for images
      if ('IntersectionObserver' in window) {
        const lazyImageObserver = new IntersectionObserver(function(entries, observer) {
          entries.forEach(function(entry) {
            if (entry.isIntersecting) {
              const lazyImage = entry.target;
              lazyImage.src = lazyImage.dataset.src;
              lazyImage.classList.add('lazy-loaded');
              lazyImageObserver.unobserve(lazyImage);
            }
          });
        });
        
        document.querySelectorAll('img[data-src]').forEach(function(lazyImage) {
          lazyImageObserver.observe(lazyImage);
        });
      }
      
      // Check if Three.js is available before setting up 3D viewer
      function checkThreeJS() {
        if (typeof THREE !== 'undefined') {
          setup3DViewer();
        } else {
          // Try again after a short delay if Three.js isn't loaded yet
          setTimeout(checkThreeJS, 100);
        }
      }
      
      // Start checking for Three.js after a brief delay to allow scripts to load
      setTimeout(checkThreeJS, 300);
    });
    
    // 3D Viewer functionality
    function setup3DViewer() {
      // ---- 3D Viewer: Three.js GLTF viewer with proper init / cleanup ----
      let renderer, scene, camera, controls, currentModel, animationId;

      function supportsWebGL() {
        try {
          const canvas = document.createElement('canvas');
          return !!(window.WebGLRenderingContext && (canvas.getContext('webgl') || canvas.getContext('experimental-webgl')));
        } catch (e) {
          return false;
        }
      }

      // Create renderer and scene inside the modal-viewer container
      function createViewer(container) {
        // renderer
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.outputEncoding = THREE.sRGBEncoding;
        renderer.domElement.style.display = 'block';
        renderer.domElement.style.width = '100%';
        renderer.domElement.style.height = '100%';
        renderer.domElement.id = 'three-canvas';

        // camera
        camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 1.2, 2.6);

        // scene
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0xf0f0f0);

        // lights
        const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
        hemi.position.set(0, 1, 0);
        scene.add(hemi);

        const dir = new THREE.DirectionalLight(0xffffff, 0.8);
        dir.position.set(3, 10, 10);
        scene.add(dir);

        // ground plane (subtle)
        const ground = new THREE.Mesh(new THREE.PlaneGeometry(2000, 2000), new THREE.MeshPhongMaterial({ color: 0xffffff, depthWrite: false }));
        ground.rotation.x = -Math.PI / 2;
        ground.position.y = -1.5;
        ground.receiveShadow = true;
        scene.add(ground);

        // controls
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.07;
        controls.screenSpacePanning = false;
        controls.minDistance = 0.6;
        controls.maxDistance = 10;
        controls.target.set(0, 0.4, 0);

        // handle resize
        function onWindowResize() {
          if (!renderer || !camera) return;
          const w = container.clientWidth;
          const h = container.clientHeight;
          camera.aspect = w / h;
          camera.updateProjectionMatrix();
          renderer.setSize(w, h);
        }
        window.addEventListener('resize', onWindowResize);

        // attach canvas
        container.appendChild(renderer.domElement);

        return function cleanup() {
          window.removeEventListener('resize', onWindowResize);
        };
      }

      // Load a GLB/GLTF model URL into the scene
      function loadModel(url, onProgress) {
        return new Promise((resolve, reject) => {
          const loader = new THREE.GLTFLoader();

          loader.load(url,
            gltf => {
              // center and scale the model reasonably
              const model = gltf.scene || gltf.scenes[0];
              model.traverse(child => {
                if (child.isMesh) {
                  child.castShadow = true;
                  child.receiveShadow = true;
                }
              });

              // compute bounding box to scale/center
              const box = new THREE.Box3().setFromObject(model);
              const size = new THREE.Vector3();
              box.getSize(size);
              const maxDim = Math.max(size.x, size.y, size.z);
              const scale = maxDim > 0 ? 1.2 / maxDim : 1;
              model.scale.setScalar(scale);

              // center
              box.setFromObject(model);
              const center = new THREE.Vector3();
              box.getCenter(center);
              model.position.sub(center);

              resolve(model);
            },
            xhr => {
              if (onProgress && xhr.total) {
                onProgress(xhr.loaded / xhr.total);
              }
            },
            err => reject(err)
          );
        });
      }

      function animate() {
        animationId = requestAnimationFrame(animate);
        if (controls) controls.update();
        if (renderer && scene && camera) renderer.render(scene, camera);
      }

      function disposeCurrentModel() {
        if (currentModel) {
          currentModel.traverse(node => {
            if (node.isMesh) {
              if (node.geometry) node.geometry.dispose();
              if (node.material) {
                if (Array.isArray(node.material)) {
                  node.material.forEach(m => { if (m.map) m.map.dispose(); m.dispose(); });
                } else {
                  if (node.material.map) node.material.map.dispose();
                  node.material.dispose();
                }
              }
            }
          });
          scene.remove(currentModel);
          currentModel = null;
        }
      }

      function cleanupViewer(cleanupHandlers=[]) {
        // stop loop
        if (animationId) {
          cancelAnimationFrame(animationId);
          animationId = null;
        }
        // dispose model
        disposeCurrentModel();
        // dispose controls
        if (controls) {
          controls.dispose();
          controls = null;
        }
        // dispose renderer
        if (renderer) {
          if (renderer.domElement && renderer.domElement.parentNode) {
            renderer.domElement.parentNode.removeChild(renderer.domElement);
          }
          renderer.dispose();
          renderer = null;
        }
        // dispose scene
        scene = null;
        camera = null;
        // run any extra cleanup
        cleanupHandlers.forEach(fn => { try { fn(); } catch(e){} });
      }

      // Modal / UI glue
      const modal = document.getElementById('modal-3d');
      const modalClose = document.getElementById('modal-close');
      const viewIn3DBtns = document.querySelectorAll('.view-in-3d');
      const viewerOverlay = document.getElementById('viewer-overlay');
      const viewerControls = document.getElementById('viewer-controls');
      const resetViewBtn = document.getElementById('reset-view');
      const modalViewerContainer = document.getElementById('modal-viewer');

      // optional: store cleanup handler returned from createViewer
      let viewerCleanupHandler = null;

      viewIn3DBtns.forEach(btn => {
        btn.addEventListener('click', async () => {
          const modelUrl = btn.getAttribute('data-model')?.trim();
          const productTitle = btn.parentElement.querySelector('.product-title')?.textContent || 'Product';
          const productDescription = btn.parentElement.querySelector('.product-description')?.textContent || '';
          const amazonAnchor = btn.parentElement.querySelectorAll('.amazon-btn')[1];

          document.getElementById('modal-product-title').textContent = productTitle;
          document.getElementById('modal-product-description').textContent = productDescription;
          document.getElementById('modal-amazon-link').href = amazonAnchor ? amazonAnchor.href : '#';

          if (!supportsWebGL()) {
            alert('WebGL is not available in your browser. Please enable hardware acceleration or try a modern browser (Chrome, Firefox, Edge).');
            return;
          }

          // show modal
          modal.style.display = 'flex';
          modal.setAttribute('aria-hidden', 'false');

          // clear previous viewer content & show loading
          viewerOverlay.style.display = 'flex';
          viewerControls.style.display = 'none';
          modalViewerContainer.querySelectorAll('#three-canvas').forEach(el => el.remove());

          // create viewer (renderer, camera, scene, controls)
          viewerCleanupHandler = createViewer(modalViewerContainer);

          try {
            // Load model (if no modelUrl provided, use fallback)
            const urlToLoad = modelUrl || 'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/DamagedHelmet/glTF-Binary/DamagedHelmet.glb';

            currentModel = await loadModel(urlToLoad, fraction => {
              // show progress (if needed)
              viewerOverlay.querySelector('.loading-spinner').style.display = 'inline-block';
            });

            // add model to scene
            scene.add(currentModel);

            // auto-fit camera to model bounds
            const box = new THREE.Box3().setFromObject(currentModel);
            const size = new THREE.Vector3(); box.getSize(size);
            const center = new THREE.Vector3(); box.getCenter(center);
            // position camera so model fits nicely
            const maxDim = Math.max(size.x, size.y, size.z);
            const fov = camera.fov * (Math.PI / 180);
            let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2)) * 1.4;
            camera.position.set(center.x, center.y + maxDim * 0.2, center.z + cameraZ);
            camera.lookAt(center);
            controls.target.copy(center);
            controls.update();

            // hide loading UI and enable controls
            viewerOverlay.style.display = 'none';
            viewerControls.style.display = 'flex';

            // start animation
            animate();
          } catch (err) {
            console.error('Error loading model:', err);
            viewerOverlay.style.display = 'none';
            modalViewerContainer.innerHTML = '<div style="padding:20px;color:#333">Failed to load 3D model. Please try again later.</div>';
          }
        });
      });

      // Reset view button
      resetViewBtn.addEventListener('click', () => {
        if (!currentModel || !camera) return;
        const box = new THREE.Box3().setFromObject(currentModel);
        const center = new THREE.Vector3(); box.getCenter(center);
        camera.position.set(center.x, center.y + 1.2, center.z + 2.6);
        controls.target.copy(center);
        controls.update();
      });

      // Close modal
      function closeModal() {
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
        // cleanup Three.js resources
        cleanupViewer([viewerCleanupHandler].filter(Boolean));
        viewerCleanupHandler = null;
        // restore viewer DOM to initial state (leave overlay element)
        modalViewerContainer.innerHTML = '';
        modalViewerContainer.appendChild(viewerOverlay);
        modalViewerContainer.appendChild(viewerControls);
        viewerOverlay.style.display = 'none';
        viewerControls.style.display = 'none';
      }

      modalClose.addEventListener('click', closeModal);
      window.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
      });
      window.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
    }
  </script>
</body>
</html>
